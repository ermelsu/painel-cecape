<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta http-equiv="refresh" content="60">
<title>Painel CECAPE - Salas</title>
<style>
    body {
        background: #112162;
        color: white;
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        padding: 0;
    }

    h1 {
        text-align: center;
        padding: 20px;
        font-size: 42px;
        color: #e9a44d;
    }

    table {
        width: 95%;
        margin: auto;
        border-collapse: collapse;
        font-size: 24px;
    }

    th {
        background: #0963b3;
        padding: 14px;
        font-size: 22px;
        text-transform: uppercase;
    }

    td {
        padding: 10px;
        background: #7092c4;
        border-bottom: 2px solid #112162;
        color: #fff;
        font-weight: 600;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    /* Flipboard animation */
    .flip {
        display: inline-block;
        animation: flipAnim 0.6s ease-in-out;
    }

    @keyframes flipAnim {
        0% { transform: rotateX(90deg); opacity: 0; }
        100% { transform: rotateX(0deg); opacity: 1; }
    }

    /* STATUS cores */
    .status-andamento {
        background: #f4d03f !important;
        color: #000 !important;
        font-weight: 900;
    }
    .status-ocupada {
        background: #f48407 !important;
    }
    .status-livre {
        background: #2ecc71 !important;
    }
    .status-evento {
        background: #0963b3 !important;
    }
    .status-manutencao {
        background: #c0392b !important;
    }
</style>
</head>

<body>
<h1>Painel de Salas - CECAPE</h1>

<table id="tabela">
    <thead>
        <tr>
            <th>Sala</th>
            <th>Bloco</th>
            <th>Andar</th>
            <th>Professor</th</th>
            <th>Horário</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
const PLANILHA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT5TbQshXscY_CKSXWmdtX7gfpYHOyDqKuDgReqcHQjpkWP6EotfNxp9sL-KQnrrQSTGevOhfVU1RnM/pubhtml";

async function carregarTabela() {
    const response = await fetch(PLANILHA_URL);
    const html = await response.text();

    // Cria documento virtual
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");

    // Captura a primeira tabela da planilha publicada
    const tabela = doc.querySelector("table");

    if (!tabela) return;

    const linhas = tabela.querySelectorAll("tr");
    const corpo = document.querySelector("#tabela tbody");
    corpo.innerHTML = "";

    linhas.forEach((linha, index) => {
        if (index === 0) return; // pula cabeçalho

        const cols = [...linha.querySelectorAll("td")].map(td => td.innerText.trim());

        if (cols.length < 6) return;

        const [sala, bloco, andar, professor, horario, status] = cols;

        const tr = document.createElement("tr");

        function tdFlip(valor) {
            const td = document.createElement("td");
            const span = document.createElement("span");
            span.classList.add("flip");
            span.textContent = valor;
            td.appendChild(span);
            return td;
        }

        tr.appendChild(tdFlip(sala));
        tr.appendChild(tdFlip(bloco));
        tr.appendChild(tdFlip(andar));
        tr.appendChild(tdFlip(professor));
        tr.appendChild(tdFlip(horario));

        const tdStatus = tdFlip(status);
        const statusLower = status.toLowerCase();

        if (statusLower === "andamento") tdStatus.classList.add("status-andamento");
        else if (statusLower === "ocupada") tdStatus.classList.add("status-ocupada");
        else if (statusLower === "livre") tdStatus.classList.add("status-livre");
        else if (statusLower === "evento") tdStatus.classList.add("status-evento");
        else if (statusLower === "manutencao" || statusLower === "manutenção")
            tdStatus.classList.add("status-manutencao");

        tr.appendChild(tdStatus);

        corpo.appendChild(tr);
    });
}

carregarTabela();
setInterval(carregarTabela, 30000);
</script>

</body>
</html>
